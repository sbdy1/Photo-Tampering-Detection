<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Forgery Detector</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
            background-color: #f4f4f4;
        }
        h2 {
            margin-top: 1.5em;
        }
        .preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1em;
            margin-top: 1em;
        }
        .preview-container img {
            max-height: 300px;
            border: 2px solid #ccc;
            border-radius: 8px;
            background: white;
            padding: 4px;
        }
        button {
            margin-top: 1em;
            padding: 0.5em 1em;
            font-size: 1em;
            border-radius: 6px;
            border: none;
            background-color: #0077cc;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background-color: #005fa3;
        }
        .section {
            margin-bottom: 2em;
        }
    </style>
</head>
<body>

    <h1>Forgery Detector</h1>

    <div class="section">
        <h2>1. Upload Original Image</h2>
        <input type="file" id="originalInput" accept="image/*">
        <div id="originalPreview" class="preview-container"></div>
    </div>

    <div class="section">
        <h2>2. Upload Suspect Images</h2>
        <input type="file" id="suspectsInput" multiple accept="image/*">
        <button onclick="uploadSuspects()">Upload Suspects</button>
        <div id="suspectStatus"></div>
        <div id="processedPreview" class="preview-container"></div>
    </div>

    <div class="section">
        <button onclick="clearAll()">Clear Everything</button>
    </div>

    <script>
        const originalInput = document.getElementById('originalInput');
        const suspectsInput = document.getElementById('suspectsInput');
        const originalPreview = document.getElementById('originalPreview');
        const processedPreview = document.getElementById('processedPreview');
        const suspectStatus = document.getElementById('suspectStatus');

        originalInput.addEventListener('change', async () => {
            const file = originalInput.files[0];
            if (!file) return;

            const formData = new FormData();
            formData.append("original", file);

            originalPreview.innerHTML = "Uploading...";
            const res = await fetch("/upload_original", {
                method: "POST",
                body: formData,
            });
            const data = await res.json();

            if (data.filename) {
                originalPreview.innerHTML = `<img src="/static/uploads/${data.filename}" alt="Original">`;
            } else {
                originalPreview.innerHTML = `<p style="color:red;">${data.error || "Upload failed."}</p>`;
            }
        });

        async function uploadSuspects() {
            const files = suspectsInput.files;
            if (!files.length) {
                suspectStatus.innerText = "Please select at least one suspect image.";
                return;
            }

            const formData = new FormData();
            for (const file of files) {
                formData.append("suspects", file);
            }

            suspectStatus.innerText = "Processing...";
            processedPreview.innerHTML = "";

            const res = await fetch("/upload_suspects", {
                method: "POST",
                body: formData,
            });

            const data = await res.json();
            if (data.processed && data.processed.length > 0) {
                suspectStatus.innerText = "Forgery analysis complete!";
                data.processed.forEach(filename => {
                    const img = document.createElement("img");
                    img.src = `/static/uploads/${filename}`;
                    processedPreview.appendChild(img);
                });
            } else {
                suspectStatus.innerHTML = `<p style="color:red;">${data.error || "No forgeries detected or upload failed."}</p>`;
            }
        }

        async function clearAll() {
            await fetch("/clear", { method: "POST" });
            originalInput.value = "";
            suspectsInput.value = "";
            originalPreview.innerHTML = "";
            processedPreview.innerHTML = "";
            suspectStatus.innerText = "";
        }
    </script>

</body>
</html>
